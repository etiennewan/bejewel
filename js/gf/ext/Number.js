///////////////////////////////////////////////////////////////////////////////
// Number Extensions

Number.__typeName = 'Number';

Number.parse = function Number$parse(s) {
	if(!s || !s.length) {
		return 0;
	}
	if((s.indexOf('.') >= 0) || (s.indexOf('e') >= 0) || s.endsWith('f') || s.endsWith('F')) {
		return parseFloat(s);
	}
	return parseInt(s, 10);
}

Number.prototype.format = function Number$format(format) {
	if(format == "0.0") {
		return this.toFixed(1);
	}
	if(format == "0.00") {
		return this.toFixed(2);
	}
	if(format == "0.000") {
		return this.toFixed(3);
	}
	if(format == "00") {
		var aStr = this.toString();
		if(aStr.length == 1) {
			return "0" + aStr;
		}
		return aStr;
	}
	if(format == "000") {
		var aStr = this.toString();
		if(aStr.length == 1) {
			return "00" + aStr;
		}
		if(aStr.length == 2) {
			return "0" + aStr;
		}
		return aStr;
	}
	if(ss.isNullOrUndefined(format) || (format.length == 0) || (format == 'i')) {
		return this.toString();
	}
	return this._netFormat(format, false);
}

Number.prototype.localeFormat = function Number$format(format) {
	if(ss.isNullOrUndefined(format) || (format.length == 0) || (format == 'i')) {
		return this.toLocaleString();
	}
	return this._netFormat(format, true);
}

Number._commaFormat = function Number$_commaFormat(number, groups, decimal, comma) {
	var decimalPart = null;
	var decimalIndex = number.indexOf(decimal);
	if(decimalIndex > 0) {
		decimalPart = number.substr(decimalIndex);
		number = number.substr(0, decimalIndex);
	}

	var negative = number.startsWith('-');
	if(negative) {
		number = number.substr(1);
	}

	var groupIndex = 0;
	var groupSize = groups[groupIndex];
	if(number.length < groupSize) {
		return decimalPart ? number + decimalPart : number;
	}

	var index = number.length;
	var s = '';
	var done = false;
	while(!done) {
		var length = groupSize;
		var startIndex = index - length;
		if(startIndex < 0) {
			groupSize += startIndex;
			length += startIndex;
			startIndex = 0;
			done = true;
		}
		if(!length) {
			break;
		}

		var part = number.substr(startIndex, length);
		if(s.length) {
			s = part + comma + s;
		} else {
			s = part;
		}
		index -= length;

		if(groupIndex < groups.length - 1) {
			groupIndex++;
			groupSize = groups[groupIndex];
		}
	}

	if(negative) {
		s = '-' + s;
	}
	return decimalPart ? s + decimalPart : s;
}

Number.prototype._netFormat = function Number$_netFormat(format, useLocale) {
	var nf = useLocale ? ss.CultureInfo.CurrentCulture.numberFormat : ss.CultureInfo.InvariantCulture.numberFormat;

	var s = '';
	var precision = -1;

	if(format.length > 1) {
		precision = parseInt(format.substr(1));
	}

	var fs = format.charAt(0);
	switch(fs) {
		case 'd':
		case 'D':
			s = parseInt(Math.abs(this)).toString();
			if(precision != -1) {
				s = s.padLeft(precision, '0');
			}
			if(this < 0) {
				s = '-' + s;
			}
			break;
		case 'x':
		case 'X':
			s = parseInt(Math.abs(this)).toString(16);
			if(fs == 'X') {
				s = s.toUpperCase();
			}
			if(precision != -1) {
				s = s.padLeft(precision, '0');
			}
			break;
		case 'e':
		case 'E':
			if(precision == -1) {
				s = this.toExponential();
			} else {
				s = this.toExponential(precision);
			}
			if(fs == 'E') {
				s = s.toUpperCase();
			}
			break;
		case 'f':
		case 'F':
		case 'n':
		case 'N':
			if(precision == -1) {
				precision = nf.numberDecimalDigits;
			}
			s = this.toFixed(precision).toString();
			if(precision && (nf.numberDecimalSeparator != '.')) {
				var index = s.indexOf('.');
				s = s.substr(0, index) + nf.numberDecimalSeparator + s.substr(index + 1);
			}
			if((fs == 'n') || (fs == 'N')) {
				s = Number._commaFormat(s, nf.numberGroupSizes, nf.numberDecimalSeparator, nf.numberGroupSeparator);
			}
			break;
		case 'c':
		case 'C':
			if(precision == -1) {
				precision = nf.currencyDecimalDigits;
			}
			s = Math.abs(this).toFixed(precision).toString();
			if(precision && (nf.currencyDecimalSeparator != '.')) {
				var index = s.indexOf('.');
				s = s.substr(0, index) + nf.currencyDecimalSeparator + s.substr(index + 1);
			}
			s = Number._commaFormat(s, nf.currencyGroupSizes, nf.currencyDecimalSeparator, nf.currencyGroupSeparator);
			if(this < 0) {
				s = String.format(nf.currencyNegativePattern, s);
			} else {
				s = String.format(nf.currencyPositivePattern, s);
			}
			break;
		case 'p':
		case 'P':
			if(precision == -1) {
				precision = nf.percentDecimalDigits;
			}
			s = (Math.abs(this) * 100.0).toFixed(precision).toString();
			if(precision && (nf.percentDecimalSeparator != '.')) {
				var index = s.indexOf('.');
				s = s.substr(0, index) + nf.percentDecimalSeparator + s.substr(index + 1);
			}
			s = Number._commaFormat(s, nf.percentGroupSizes, nf.percentDecimalSeparator, nf.percentGroupSeparator);
			if(this < 0) {
				s = String.format(nf.percentNegativePattern, s);
			} else {
				s = String.format(nf.percentPositivePattern, s);
			}
			break;
	}

	return s;
}

///////////////////////////////////////////////////////////////////////////////
// Math Extensions

Math.truncate = function Math$truncate(n) {
	return (n >= 0) ? Math.floor(n) : Math.ceil(n);
}